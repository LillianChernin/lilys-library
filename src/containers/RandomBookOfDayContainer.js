import React, {Component} from 'react';
import RandomBookOfDay from '../components/randomBookOfDay/RandomBookOfDay';
import BookModel from '../models/Book';

class RandomBookOfDayContainer extends Component {
  constructor() {
    super();
    this.state = {
      book: ""
    }
    this.getDayofYear = this.getDayofYear.bind(this);
    this.generateRandomBook = this.generateRandomBook.bind(this);
  }
  getDayofYear() {
    let currentDay = new Date();
    let startOfYear = new Date(currentDay.getFullYear(), 0, 0);
    let diff = currentDay - startOfYear;
    let oneDay = 1000 * 60 * 60 * 24;
    let day = Math.floor(diff / oneDay);
    return day;
  }

  generateRandomBook() {
    let shuffledDayNum = {'0':185,'1':46,'2':301,'3':260,'4':94,'5':122,'6':29,'7':119,'8':99,'9':178,'10':332,'11':330,'12':53,'13':268,'14':159,'15':327,'16':132,'17':112,'18':156,'19':306,
    '20':101,'21':226,'22':296,'23':328,'24':289,'25':200,'26':209,'27':180,'28':294,'29':52,'30':298,'31':193,'32':335,'33':279,'34':142,'35':336,'36':314,'37':17,
    '38':90,'39':182,'40':13,'41':313,'42':77,'43':27,'44':64,'45':9,'46':229,'47':233,'48':23,'49':109,'50':118,'51':242,'52':340,'53':141,'54':263,'55':304,'56':208,
    '57':192,'58':163,'59':14,'60':308,'61':2,'62':271,'63':171,'64':347,'65':7,'66':177,'67':73,'68':114,'69':342,'70':59,'71':240,'72':246,'73':85,'74':207,'75':305,
    '76':320,'77':136,'78':231,'79':86,'80':11,'81':210,'82':232,'83':329,'84':204,'85':179,'86':12,'87':198,'88':115,'89':116,'90':219,'91':144,'92':293,'93':189,'94':15,
    '95':256,'96':8,'97':127,'98':166,'99':37,'100':110,'101':311,'102':255,'103':108,'104':348,'105':126,'106':19,'107':80,'108':235,'109':312,'110':43,'111':107,'112':264,'113':145,'114':277,
    '115':218,'116':60,'117':154,'118':302,'119':34,'120':164,'121':42,'122':194,'123':238,'124':355,'125':323,'126':216,'127':41,'128':168,'129':315,'130':220,'131':316,
    '132':280,'133':176,'134':310,'135':307,'136':97,'137':236,'138':324,'139':247,'140':352,'141':49,'142':39,'143':187,'144':303,'145':201,'146':50,'147':138,'148':292,
    '149':283,'150':3,'151':174,'152':20,'153':125,'154':337,'155':309,'156':267,'157':213,'158':363,'159':339,'160':16,'161':254,'162':322,'163':257,'164':258,'165':83,'166':253,
    '167':221,'168':351,'169':354,'170':130,'171':273,'172':317,'173':82,'174':162,'175':140,'176':244,'177':358,'178':350,'179':175,'180':71,'181':120,'182':343,'183':22,
    '184':143,'185':285,'186':129,'187':70,'188':259,'189':297,'190':217,'191':40,'192':274,'193':35,'194':1,'195':275,'196':243,'197':133,'198':72,'199':173,'200':44,'201':106,'202':123,
    '203':272,'204':346,'205':121,'206':113,'207':33,'208':89,'209':250,'210':334,'211':103,'212':102,'213':62,'214':281,'215':325,'216':169,'217':87,'218':212,'219':79,'220':76,'221':69,'222':356,
    '223':78,'224':365,'225':66,'226':362,'227':54,'228':321,'229':92,'230':188,'231':265,'232':157,'233':326,'234':251,'235':318,'236':160,'237':111,'238':61,'239':183,'240':290,
    '241':137,'242':56,'243':241,'244':26,'245':249,'246':270,'247':359,'248':203,'249':58,'250':25,'251':10,'252':139,'253':81,'254':98,'255':282,'256':167,'257':31,'258':357,'259':51,
    '260':68,'261':224,'262':287,'263':149,'264':105,'265':228,'266':74,'267':18,'268':186,'269':331,'270':266,'271':278,'272':30,'273':88,'274':345,
    '275':181,'276':146,'277':47,'278':21,'279':161,'280':36,'281':245,'282':364,'283':104,'284':95,'285':6,'286':93,'287':147,'288':199,'289':211,'290':286,'291':170,'292':151,'293':234,
    '294':131,'295':5,'296':191,'297':295,'298':84,'299':75,'300':344,'301':124,'302':158,'303':360,'304':117,'305':349,'306':261,'307':227,'308':299,'309':269,
    '310':300,'311':353,'312':202,'313':155,'314':65,'315':225,'316':100,'317':57,'318':24,'319':333,'320':91,'321':153,'322':291,'323':262,'324':38,'325':148,'326':134,'327':190,
    '328':196,'329':45,'330':239,'331':184,'332':195,'333':152,'334':230,'335':237,'336':361,'337':197,'338':319,'339':288,'340':135,'341':4,'342':206,'343':48,'344':248,'345':32,
    '346':338,'347':276,'348':214,'349':172,'350':341,'351':96,'352':128,'353':165,'354':205,'355':252,'356':67,'357':215,'358':150,'359':284,'360':223,'361':55,'362':63,'363':28,'364':222}
    let allBookArray;
    let self = this;
    let currentDay = this.getDayofYear();
    let currentDayAsString = currentDay.toString;
    BookModel.all().then((res) => {
      allBookArray = res.data;
      let selectedBookIndex = (shuffledDayNum[currentDay]) % (allBookArray.length);
      let selectedBook = allBookArray[selectedBookIndex];
      self.setState({
        book: selectedBook
      })
    })
  }
  render() {
    if (this.state.book !== "") {
      return (
        <div className="RandomBookOfDayContainer">
          <RandomBookOfDay
            book={this.state.book}
          />
        </div>
      )
    }
    if (this.state.book === "") {
      this.generateRandomBook();
    }
    return (
      <div className="RandomBookOfDayContainer">
      </div>
    )
  }
}

export default RandomBookOfDayContainer;
